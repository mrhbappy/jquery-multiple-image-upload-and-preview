$.fn.imageUpload=function(){return this.each(function(){$(this).on('change',function(e){let files=e.target.files;let $this=$(this);if($this.next('.image-preview').length===0){$this.after('<div class="image-preview"></div>');}imageUpload($this,files);});});};function imageUpload(inputClass,files){Array.from(files).forEach(function(file){let reader=new FileReader();reader.onload=function(e){let previewContainer=$('<div class="preview-container">');let image=$('<img class="preview-image">').attr('src',e.target.result);let removeButton=$('<div class="remove-image">X</div>');removeButton.on('click',function(){previewContainer.remove();updateInputField(inputClass);});image.data('file',file);previewContainer.append(image,removeButton);inputClass.next('.image-preview').append(previewContainer);updateInputField(inputClass);};reader.readAsDataURL(file);});}function updateInputField(inputClass){let currentFiles=inputClass.next('.image-preview').find('.preview-container img').map(function(){return $(this).data('file');}).get();let newFileList=new DataTransfer();currentFiles.forEach(function(file){newFileList.items.add(file);});inputClass.prop('files',newFileList.files);}
